<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>変更申請ガイド | 書類記入ナビ</title>
    <meta name="description" content="変更申請書類の記入方法を音声でガイドします">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div class="container">
        <header class="header">
            <h1 class="header__title">📝 変更申請</h1>
            <p class="header__subtitle">委任状2枚の書き方</p>
        </header>

        <main class="step-content">
            <!-- プログレスバー -->
            <div class="progress-bar">
                <div class="progress-bar__fill" style="width: 11%;"></div>
            </div>

            <!-- ステップ表示 -->
            <div class="step-indicator">
                <span>ステップ</span>
                <span class="step-indicator__current">1</span>
                <span>/ <span class="step-indicator__total">9</span></span>
            </div>

            <!-- 音声コントロール -->
            <div class="audio-control">
                <button class="audio-control__btn" onclick="toggleSpeak(stepNavigator.getCurrentStep().voice)"
                    aria-label="読み上げ">
                    🔊
                </button>
                <span style="font-size: var(--font-size-base);">タップで読み上げ</span>
            </div>

            <!-- コンテンツ -->
            <div class="content">
                <!-- 警告バッジ -->
                <div class="warning-badge" style="display: none;">✕</div>

                <!-- 画像（プレースホルダー） -->
                <div class="placeholder-image">
                    <div class="placeholder-image__icon">📄</div>
                    <div class="placeholder-image__text">画像を挿入予定</div>
                </div>
                <img class="content__image" src="" alt="" style="display: none;">

                <!-- 説明テキスト -->
                <p class="content__text"></p>
            </div>

            <!-- ナビゲーション -->
            <div class="navigation">
                <button class="btn btn--secondary btn--prev" onclick="goPrev(stepNavigator)"
                    style="visibility: hidden;">
                    ← 戻る
                </button>
                <button class="btn btn--primary btn--next" onclick="goNext(stepNavigator)">
                    次へ →
                </button>
            </div>

            <!-- 法的注記 -->
            <div class="legal-notes" style="display: none;">
                <button class="legal-notes__toggle" onclick="toggleLegalNotes()">
                    ▶ 法的注意事項を見る
                </button>
                <div class="legal-notes__content"></div>
            </div>

            <!-- ヘルプセクション -->
            <div class="help-section">
                <button class="help-btn" onclick="showPhoneModal()">
                    ❓ どうしてもわからない
                </button>
            </div>
        </main>

        <!-- 完了画面 -->
        <div class="complete" style="display: none;">
            <div class="complete__icon">✅</div>
            <h2 class="complete__title">お疲れ様でした！</h2>
            <p class="complete__message">
                これで変更申請の書類は完成です。<br><br>
                書類を封筒に入れて<br>
                <strong>返送</strong>してください。
            </p>
            <div style="margin-top: var(--spacing-lg); display: flex; flex-direction: column; gap: var(--spacing-sm);">
                <button class="btn btn--secondary" onclick="goBackFromComplete(stepNavigator)">
                    ← ひとつ前に戻る
                </button>
                <a href="index.html" class="btn btn--primary">
                    🏠 最初に戻る
                </a>
            </div>
        </div>
    </div>

    <!-- ヘルプモーダル（1段階目：確認） -->
    <div class="phone-modal" id="helpModal1" onclick="closeHelpModal()">
        <div class="phone-modal__content" onclick="event.stopPropagation()">
            <h3 class="phone-modal__title">❓ 本当にわからないですか？</h3>
            <p class="phone-modal__message">
                もう一度、説明を読み直してみてください。<br><br>
                それでもわからない場合は、<br>
                下のボタンを押してください。
            </p>
            <button class="btn btn--primary" onclick="showHelpModal2()" style="margin-bottom: var(--spacing-sm);">
                はい、問い合わせたい
            </button>
            <button class="phone-modal__close" onclick="closeHelpModal()">
                戻る
            </button>
        </div>
    </div>

    <!-- ヘルプモーダル（2段階目：連絡先表示） -->
    <div class="phone-modal" id="helpModal2" onclick="closeHelpModal()">
        <div class="phone-modal__content" onclick="event.stopPropagation()">
            <h3 class="phone-modal__title">📞 お問い合わせ</h3>
            <p class="phone-modal__message">
                下記にご連絡ください。
            </p>
            <a href="tel:080-1944-0234" class="phone-modal__number">
                📞 080-1944-0234
            </a>
            <a href="mailto:info@sanjininc.com" class="phone-modal__number"
                style="background: #0052CC; margin-top: var(--spacing-sm);">
                ✉️ info@sanjininc.com
            </a>
            <button class="phone-modal__close" onclick="closeHelpModal()" style="margin-top: var(--spacing-md);">
                閉じる
            </button>
        </div>
    </div>

    <!-- 音声許可バナー（iOS用） -->
    <div class="audio-permission">
        <p style="font-size: var(--font-size-large); margin-bottom: var(--spacing-sm);">
            🔊 音声ガイドを有効にしますか？
        </p>
        <button class="audio-permission__btn" onclick="enableAudioManually()">
            音声をオンにする
        </button>
    </div>

    <script src="js/speech.js"></script>
    <script src="js/navigation.js"></script>
    <script>
        // コースA: 変更申請のステップ定義
        const courseASteps = [
            {
                text: '変更申請の書類一式を出してください。<br><br>まずは、<strong>「委任状１」（表や枠線がない、文字だけの委任状）</strong>を手元に置いてください。<br><br><small style="color: var(--text-secondary);">*照会案件毎に委任状を添付してください<br>*複数枚にわたる場合は、それぞれに署名・捩印を行ってください</small>',
                voice: '変更申請の書類一式を出してください。まずは、委任状１、表や枠線がない、文字だけの委任状を手元に置いてください。注意事項です。照会案件毎に委任状を添付してください。複数枚にわたる場合は、それぞれに署名・なついんを行ってください。',
                image: 'images/illustration_document.png',
                imageAlt: '委任状のイメージ',
                showWarning: false
            },
            {
                text: 'その紙の<strong class="warning-text">右上の日付</strong>を見てください。<br><br><span class="warning-text">そこは空欄のままです。<br>書かないでください。</span>',
                voice: 'その紙の右上の日付を見てください。そこは空欄のままです。書かないでください。',
                image: 'images/illustration_date_warning.png',
                imageAlt: '日付欄は空欄のまま',
                showWarning: true
            },
            {
                text: '日付の下にある<strong>住所と氏名</strong>の欄を見つけてください。<br><br>必ず<strong>住民票と同じ住所・氏名</strong>で書いてください。',
                voice: '日付の下にある住所と氏名の欄を見つけてください。必ず住民票と同じ住所・氏名で書いてください。',
                image: 'images/illustration_name_address.png',
                imageAlt: '日付の下にある住所・氏名欄',
                showWarning: false
            },
            {
                text: '氏名の<strong>右横にある「実印」欄</strong>を見つけてください。<br><br>確認です。<br>それは<strong class="warning-text">印鑑登録してあるハンコ</strong>ですか？<br><span style="color: var(--danger);">(認印は不可)</span><br><br>きれいに押せましたか？<br><strong class="warning-text">かすれや欠け</strong>はありませんか？<br><br><strong>もし失敗したら、隣に押し直してください。</strong><br><br><small style="color: var(--text-secondary);">*照会案件毎に委任状を添付してください<br>*複数枚にわたる場合は、それぞれに署名・捩印を行ってください</small>',
                voice: '氏名の右横にある実印欄を見つけてください。そこに実印を押します。確認です、それは印鑑登録してあるハンコですか？認印は使えません。きれいに押せましたか？かすれや欠けはありませんか？もし失敗したら、隣に押し直してください。',
                image: 'images/illustration_stamp.png',
                imageAlt: '実印を押す',
                showWarning: false
            },
            {
                text: '今の書類は置いて、<br><strong>「委任状２」（表・枠線がある委任状）</strong>を出してください。<br><br><small style="color: var(--text-secondary);">*照会案件毎に委任状を添付してください<br>*複数枚にわたる場合は、それぞれに署名・捩印を行ってください</small>',
                voice: '今の書類は置いて、委任状２、表・枠線がある委任状を出してください。',
                image: 'images/illustration_table.png',
                imageAlt: '表がある委任状のイメージ',
                showWarning: false
            },
            {
                text: 'この書類も、<strong class="warning-text">右上の日付は空欄のまま</strong>です。',
                voice: 'この書類も、右上の日付は空欄のままです。書かないでください。',
                image: 'images/illustration_date_warning.png',
                imageAlt: '日付欄は空欄のまま',
                showWarning: true
            },
            {
                text: '上の欄に、<strong>住所・氏名</strong>を書き、<br><strong>実印</strong>を押してください。<br><br>住所は<strong class="warning-text">住民票と同じ住所・氏名</strong>で書いてください。',
                voice: '上の欄に、住所と氏名を書き、実印を押してください。住所は住民票と同じ住所・氏名で書いてください。',
                image: 'images/illustration_name_address.png',
                imageAlt: '住所・氏名・捺印欄',
                showWarning: false
            },
            {
                text: '真ん中にある「対象事業計画」という<strong>表</strong>を見てください。<br><br>表の中の<strong>「設備ID」</strong>欄に、<strong class="warning-text">設備ID</strong>をお書きください。<br><strong class="warning-text">それ以外の欄は空欄のままでOKです。</strong><br><br><small style="color: var(--text-secondary);">※設備IDが不明の場合、ご契約の電力会社にお問い合わせください<br><br>※申請毎に委任状を添付すること。委任をされる事業者が同じ場合であり、かつ、手続区分が同一の場合に限り、一つの委任状にて、複数の申請を行うことが出来る。ただし、一枚に記載することが出来ない場合、一枚に収まる設備ID分のみを記入し、残りの設備IDについて、同様式を別途作成すること。</small>',
                voice: '真ん中にある対象事業計画という表を見てください。表の中の設備ID欄に、設備IDをお書きください。それ以外の欄は空欄のままでオーケーです。設備IDが不明の場合は、ご契約の電力会社にお問い合わせください。',
                image: 'images/illustration_equipment_id.png',
                imageAlt: '設備IDを記入',
                showWarning: false
            },
            {
                text: '<strong>最終確認</strong><br><br>以下の書類がすべて揃っているか確認してください。<br><br><div style="text-align: left; background: white; padding: 12px; border-radius: 8px; border: 2px solid var(--primary);"><label style="display: block; margin-bottom: 12px; font-size: 18px;"><input type="checkbox" style="width: 24px; height: 24px; margin-right: 8px;"> 委任状１（住所・氏名・実印）</label><label style="display: block; font-size: 18px;"><input type="checkbox" style="width: 24px; height: 24px; margin-right: 8px;"> 委任状２（住所・氏名・実印・設備ID）</label></div>',
                voice: '最終確認です。以下の書類がすべて揃っているか確認してください。委任状１に住所、氏名、実印。委任状２に住所、氏名、実印、設備ID。すべて揃っていれば、次へ進んでください。',
                image: '',
                imageAlt: '',
                showWarning: false
            }
        ];

        // ナビゲーター初期化
        const stepNavigator = new StepNavigator(courseASteps);

        // 初期表示
        window.onload = function () {
            renderStep(stepNavigator);
        };
    </script>
</body>

</html>